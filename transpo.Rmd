---
title: "forecast1"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(magrittr)
library(tidyverse)
library(xts)
library(imputeTS)
library(dygraphs)
library(lubridate)
library(scales)

```


```{r data loading}
data<-read_csv("transpo2.csv")
data$Timestamp %<>% mdy_hm() 
names(data)<-c("time","real","block")

data$block %<>% na_interpolation()
data$real %<>% na_interpolation()
data$hour<-hour(data$time)
data$date<-as.Date(data$time)
data$block<-data$block*.25 #to kilowatt-hour

#Let's get that data into hourly
data2<- data %>% group_by(hour,date) %>% summarise_at("block",sum) %>% mutate(time=paste0(date," ",hour,":","00")) %>% mutate_at("time",ymd_hm) %>% arrange(time)

#data2$ts<-as.xts(data2$real,order.by = data2$time)

data2$ts<-xts(data2$block,order.by = data2$time,frequency = 24)
attr(data2$ts,'frequency')<-24
periodicity(data2$ts)

transportation.xts<-data2$ts

decom<-decompose(as.ts(transportation.xts))
plot(decom)
data2$trend<-decom$trend

gg1<-data2 %>% ggplot(aes(x=date,y=trend)) + geom_line() + geom_smooth()   + scale_x_date(date_labels = "%b %y",breaks="2 months") + ylab("kWh/hr") + xlab("Date")+ theme(axis.text.x=element_text(angle=45))
gg1

#daily peaks

data3<- data2 %>% group_by(date) %>% summarise_at("block",max) %>% ggplot(aes(x=date,y=block)) + geom_line() + geom_smooth()   + scale_x_date(date_labels = "%b %y",breaks="2 months") + ylab("Peak kWh/hr") + xlab("Date")+ scale_y_continuous(breaks=seq(250,1500,250)) + theme(axis.text.x=element_text(angle=45))
  
```

